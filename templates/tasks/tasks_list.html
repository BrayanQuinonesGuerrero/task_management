{% extends 'layouts/base.html' %}


{% block title %}
    Task list
{% endblock title %}

{% block content %}
  <div class="container mt-5 pt-4">
    <h1 class="text-center mb-4">Hello, welcome to your Task list, {{ user.first_name|capfirst }}</h1>

    <!-- Task list -->
    <div class="row">
      {% for task in tasks %}
        <div class="col-md-6 col-lg-4 mb-4">
          <!-- Apply a conditional class for completed tasks -->
          <div class="card shadow-sm h-100 {% if task.status == 'completed' %}bg-light text-muted border-success{% endif %}">
            <div class="card-body">
              <h5 class="card-title">{{ task.title|capfirst }}</h5>
              <p class="card-text">
                <strong>Priority:</strong> {{ task.get_priority_display }}<br>
                <strong>Status:</strong> {{ task.get_status_display }}<br>
                <strong>Due Date:</strong> {{ task.due_date|date:"j \d\e F \d\e\l Y"|capfirst }}
              </p>
              <div class="d-flex justify-content-between">
                <a href="{% url 'tasks:task_detail' task.pk %}" class="btn btn-primary btn-sm">View</a>
                <a href="{% url 'tasks:task_update' task.pk %}" class="btn btn-secondary btn-sm">Edit</a>
                <a href="#" class="btn btn-danger btn-sm delete-task-btn" data-task-id="{{ task.pk }}" data-task-title="{{ task.title }}">Delete</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Delete confirmation modal -->
  <div class="modal fade" id="deleteTaskModal" tabindex="-1" aria-labelledby="deleteTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteTaskModalLabel">Confirm Delete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete the task: "<span id="taskTitle"></span>"?</p>
        </div>
        <div class="modal-footer">
          <form id="deleteTaskForm" method="POST">
            {% csrf_token %}
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-danger">Yes, delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block extra_js %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const deleteTaskBtns = document.querySelectorAll(".delete-task-btn");
      const deleteModal = new bootstrap.Modal(document.getElementById("deleteTaskModal"));
      const taskTitleSpan = document.getElementById("taskTitle");
      const deleteTaskForm = document.getElementById("deleteTaskForm");

      deleteTaskBtns.forEach((btn) => {
        btn.addEventListener("click", function (event) {
          event.preventDefault();
          const taskId = this.getAttribute("data-task-id");
          const taskTitle = this.getAttribute("data-task-title");

          taskTitleSpan.textContent = taskTitle;
          deleteTaskForm.action = `{% url 'tasks:task_delete' 0 %}`.replace("0", taskId);
          deleteModal.show();
        });
      });
    });
  </script>
{% endblock extra_js %}